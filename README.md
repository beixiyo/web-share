# ğŸ”— Web Airdrop

åœ¨æµè§ˆå™¨å®ç°å±€åŸŸç½‘æ–‡ä»¶ä¼ è¾“ï¼Œæ— æœåŠ¡å™¨æ”¶é›†ä¿¡æ¯ï¼Œè®©æµè§ˆå™¨å†æ¬¡ä¼Ÿå¤§ï¼ï¼

<p align="center">
  <img src="https://img.shields.io/badge/Vue.js-4FC08D?logo=vuedotjs&logoColor=white" />
  <img src="https://img.shields.io/badge/TypeScript-3178C6?logo=typescript&logoColor=white" />
  <img src="https://img.shields.io/badge/Vite-646CFF?logo=vite&logoColor=white" />
  <img src="https://img.shields.io/badge/GitHub-181717?logo=github&logoColor=white" />
</p>

<div style="display: flex; flex-wrap: wrap; gap: 1rem; justify-content: center; align-items: center;">
  <img src="./docAssets/theme.webp" width="300px" />
  <img src="./docAssets/save.webp" width="300px" />
</div>

## âœ¨ æ ¸å¿ƒåŠŸèƒ½äº®ç‚¹

#### âš¡ é«˜æ€§èƒ½ç‚¹å¯¹ç‚¹ä¼ è¾“
- **ğŸ«— æµå¼ä¸‹è½½**ï¼šä¼ ç»Ÿå‰ç«¯ä¸‹è½½è¦ä¿å­˜æ‰€æœ‰åˆ†ç‰‡åˆ°å†…å­˜ï¼Œä¼ è¾“å†…å®¹å¤§äº†ä¼šå´©æºƒ
- **â¬‡ï¸ æ— é™å¤§å°æ–‡ä»¶ä¼ è¾“**ï¼šä½¿ç”¨ Service Worker æˆ– File System Access API å®ç°åå°æµå¼ä¸‹è½½ï¼ˆéœ€æµè§ˆå™¨æ”¯æŒï¼‰
- **ğŸ”„ æµæ§åˆ¶æœºåˆ¶**ï¼šæ™ºèƒ½ç¼“å†²åŒºç®¡ç†ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºå’Œä¼ è¾“é˜»å¡
- **ğŸŒ ç›´è¿æŠ€æœ¯**ï¼šåŸºäº WebRTC DataChannel å®ç°æµè§ˆå™¨é—´ç›´æ¥è¿æ¥

### ğŸ”„ æ™ºèƒ½æ–­ç‚¹ç»­ä¼ 
> **å¤§æ–‡ä»¶ä¼ è¾“çš„å¯é ä¿éšœ**

- **ğŸ§  æ™ºèƒ½ç¼“å­˜æœºåˆ¶**ï¼šåŸºäºæ–‡ä»¶å+æ–‡ä»¶å¤§å°ç”Ÿæˆå”¯ä¸€å“ˆå¸Œæ ‡è¯†ï¼Œç¡®ä¿æ–­ç‚¹ç»­ä¼ çš„å‡†ç¡®æ€§
- **ğŸ’¾ æœ¬åœ°æ•°æ®æŒä¹…åŒ–**ï¼šåˆ©ç”¨ IndexedDB å­˜å‚¨ä¼ è¾“è¿›åº¦å’Œæ•°æ®å—ï¼Œæ”¯æŒæµè§ˆå™¨é‡å¯åæ¢å¤ä¼ è¾“
- **ğŸ”„ è‡ªåŠ¨åå•†æ¢å¤**ï¼šå‘é€ç«¯å’Œæ¥æ”¶ç«¯é€šè¿‡ WebRTC è‡ªåŠ¨åå•†ä¼ è¾“èµ·å§‹ä½ç½®ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
- **âš¡ ç§’çº§æ¢å¤é€Ÿåº¦**ï¼šä¸­æ–­åé‡è¿ï¼Œç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶ä»æ–­ç‚¹ä½ç½®ç»§ç»­ï¼Œå¤§å¹…èŠ‚çœä¼ è¾“æ—¶é—´
- **ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§ä¿è¯**ï¼šå¤šé‡æ ¡éªŒæœºåˆ¶ç¡®ä¿æ–­ç‚¹ç»­ä¼ æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§

### ğŸ¯ ä¾¿æ·æ–‡ä»¶æ“ä½œ
> **æè‡´çš„ç”¨æˆ·ä½“éªŒè®¾è®¡**

- **ğŸ–±ï¸ æ‹–æ‹½å³ä¼ **ï¼šæ”¯æŒç›´æ¥å°†æ–‡ä»¶æ‹–æ‹½åˆ°æµè§ˆå™¨çª—å£ï¼Œè‡ªåŠ¨è¯†åˆ«å¹¶å‡†å¤‡ä¼ è¾“
- **ğŸ“‹ ç²˜è´´ä¼ è¾“**ï¼šä½¿ç”¨ `Ctrl + V` å¿«æ·é”®ç›´æ¥ç²˜è´´å‰ªè´´æ¿ä¸­çš„æ–‡ä»¶ï¼Œæ”¯æŒæˆªå›¾ã€å¤åˆ¶æ–‡ä»¶ç­‰åœºæ™¯
- **ğŸ“ æ‰¹é‡é€‰æ‹©**ï¼šæ”¯æŒåŒæ—¶é€‰æ‹©å¤šä¸ªæ–‡ä»¶è¿›è¡Œæ‰¹é‡ä¼ è¾“ï¼Œæé«˜å·¥ä½œæ•ˆç‡
- **ğŸ” æ–‡ä»¶é¢„è§ˆ**ï¼šä¼ è¾“å‰è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶é¢„è§ˆå›¾å’Œè¯¦ç»†ä¿¡æ¯ï¼Œç¡®ä¿ä¼ è¾“å†…å®¹å‡†ç¡®æ— è¯¯
- **ğŸ“Š å®æ—¶è¿›åº¦**ï¼šç²¾ç¡®æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„ä¼ è¾“è¿›åº¦ã€é€Ÿåº¦å’Œå‰©ä½™æ—¶é—´

### ğŸ’¬ è·¨è®¾å¤‡æ–‡æœ¬å…±äº«
> **æ— ç¼çš„æ–‡æœ¬ä¼ è¾“ä½“éªŒ**

- **ğŸ“ å³æ—¶æ–‡æœ¬ä¼ è¾“**ï¼šæ”¯æŒçº¯æ–‡æœ¬ã€å¯Œæ–‡æœ¬ã€ä»£ç ç‰‡æ®µç­‰å¤šç§æ–‡æœ¬æ ¼å¼çš„å¿«é€Ÿä¼ è¾“
- **ğŸ”„ åŒå‘åŒæ­¥**ï¼šä»»æ„è®¾å¤‡éƒ½å¯ä»¥å‘é€å’Œæ¥æ”¶æ–‡æœ¬å†…å®¹ï¼ŒçœŸæ­£å®ç°è·¨è®¾å¤‡åä½œ
- **ğŸ“‹ ä¸€é”®å¤åˆ¶**ï¼šæ¥æ”¶åˆ°çš„æ–‡æœ¬å†…å®¹æ”¯æŒä¸€é”®å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨
- **ğŸ¨ æ ¼å¼ä¿æŒ**ï¼šä¿æŒåŸå§‹æ–‡æœ¬çš„æ ¼å¼å’Œç¼–ç ï¼Œç¡®ä¿ç‰¹æ®Šå­—ç¬¦å’Œæ¢è¡Œç¬¦çš„å‡†ç¡®ä¼ è¾“
- **âš¡ æ¯«ç§’çº§ä¼ è¾“**ï¼šæ–‡æœ¬ä¼ è¾“å»¶è¿Ÿæä½ï¼Œå®ç°è¿‘ä¹å®æ—¶çš„è·¨è®¾å¤‡æ–‡æœ¬åŒæ­¥

### ğŸ“± äºŒç»´ç å¿«é€Ÿè¿æ¥
> **ç§»åŠ¨è®¾å¤‡çš„æœ€ä½³è¿æ¥æ–¹æ¡ˆ**

- **ğŸ“² æ‰«ç å³è¿**ï¼šè‡ªåŠ¨ç”Ÿæˆé«˜æ¸…äºŒç»´ç ï¼Œæ‰‹æœºæ‰«ç å³å¯å¿«é€ŸåŠ å…¥ä¼ è¾“ä¼šè¯
- **ğŸ”„ åŠ¨æ€æ›´æ–°**ï¼šäºŒç»´ç åŒ…å«å®Œæ•´çš„è¿æ¥ä¿¡æ¯ï¼Œæ”¯æŒæˆ¿é—´çŠ¶æ€çš„å®æ—¶æ›´æ–°
- **ğŸ“± ç§»åŠ¨ä¼˜åŒ–**ï¼šé’ˆå¯¹ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–çš„äºŒç»´ç å°ºå¯¸å’Œè¯†åˆ«ç®—æ³•ï¼Œç¡®ä¿å¿«é€Ÿè¯†åˆ«
- **ğŸ”’ å®‰å…¨ç¼–ç **ï¼šäºŒç»´ç å†…å®¹ç»è¿‡åŠ å¯†å¤„ç†ï¼Œé˜²æ­¢æ¶æ„æˆªè·å’Œä¼ªé€ 
- **â° æ™ºèƒ½è¿‡æœŸ**ï¼šäºŒç»´ç å…·æœ‰æ—¶æ•ˆæ€§ï¼Œè¿‡æœŸè‡ªåŠ¨å¤±æ•ˆï¼Œä¿éšœè¿æ¥å®‰å…¨

### ğŸ”¢ æˆ¿é—´ç ä¾¿æ·è¿æ¥
> **ç®€å•æ˜“è®°çš„è¿æ¥æ–¹å¼**

- **ğŸ² æ™ºèƒ½ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆ6ä½æ•°å­—æˆ¿é—´ç ï¼Œæ˜“äºè®°å¿†å’Œè¾“å…¥
- **â±ï¸ çµæ´»æœ‰æ•ˆæœŸ**ï¼šæ”¯æŒè‡ªå®šä¹‰æˆ¿é—´ç æœ‰æ•ˆæœŸï¼Œå¹³è¡¡ä¾¿åˆ©æ€§å’Œå®‰å…¨æ€§
- **ğŸ”„ ä¸€ç å¤šè¿**ï¼šåŒä¸€æˆ¿é—´ç æ”¯æŒå¤šè®¾å¤‡åŒæ—¶è¿æ¥ï¼Œå®ç°å¤šæ–¹æ–‡ä»¶å…±äº«
- **ğŸ“ è¯­éŸ³ä¼ è¾¾**ï¼šçº¯æ•°å­—è®¾è®¡ä¾¿äºç”µè¯æˆ–è¯­éŸ³ä¼ è¾¾ï¼Œé€‚åˆå„ç§æ²Ÿé€šåœºæ™¯
- **ğŸ›¡ï¸ é˜²æš´åŠ›ç ´è§£**ï¼šå†…ç½®é¢‘ç‡é™åˆ¶å’Œé”™è¯¯æ¬¡æ•°é™åˆ¶ï¼Œé˜²æ­¢æ¶æ„å°è¯•

### ğŸ”„ æ™ºèƒ½è‡ªåŠ¨é‡è¿
> **ç½‘ç»œæ³¢åŠ¨ä¸‹çš„ç¨³å®šä¼ è¾“**

- **ğŸ” å®æ—¶ç›‘æµ‹**ï¼šæŒç»­ç›‘æ§ WebRTC è¿æ¥çŠ¶æ€å’Œç½‘ç»œè´¨é‡ï¼ŒåŠæ—¶å‘ç°è¿æ¥é—®é¢˜
- **âš¡ å¿«é€Ÿé‡è¿**ï¼šç½‘ç»œä¸­æ–­åè‡ªåŠ¨å°è¯•é‡æ–°å»ºç«‹è¿æ¥ï¼Œå¹³å‡é‡è¿æ—¶é—´å°äº3ç§’
- **ğŸ¯ æ™ºèƒ½ç­–ç•¥**ï¼šæ ¹æ®ç½‘ç»œç¯å¢ƒè‡ªåŠ¨è°ƒæ•´é‡è¿ç­–ç•¥å’Œé¢‘ç‡ï¼Œé¿å…æ— æ•ˆå°è¯•
- **ğŸ’¾ çŠ¶æ€ä¿æŒ**ï¼šé‡è¿è¿‡ç¨‹ä¸­ä¿æŒä¼ è¾“çŠ¶æ€å’Œè¿›åº¦ä¿¡æ¯ï¼Œç¡®ä¿æ— ç¼æ¢å¤
- **ğŸ”” ç”¨æˆ·æé†’**ï¼šè¿æ¥çŠ¶æ€å˜åŒ–æ—¶æä¾›æ¸…æ™°çš„è§†è§‰åé¦ˆï¼Œè®©ç”¨æˆ·äº†è§£å½“å‰çŠ¶æ€

### ğŸš€ å…¶ä»–æŠ€æœ¯äº®ç‚¹

#### ğŸ” ç«¯åˆ°ç«¯å®‰å…¨ä¼ è¾“
- **ğŸ›¡ï¸ WebRTC åŸç”ŸåŠ å¯†**ï¼šåˆ©ç”¨ DTLS å’Œ SRTP åè®®æä¾›ç«¯åˆ°ç«¯åŠ å¯†ä¿æŠ¤
- **ğŸš« é›¶æœåŠ¡å™¨å­˜å‚¨**ï¼šæ–‡ä»¶ç›´æ¥åœ¨è®¾å¤‡é—´ä¼ è¾“ï¼ŒæœåŠ¡å™¨ä¸å­˜å‚¨ä»»ä½•ç”¨æˆ·æ•°æ®
- **ğŸ”’ ä¼šè¯éš”ç¦»**ï¼šæ¯ä¸ªä¼ è¾“ä¼šè¯ç‹¬ç«‹åŠ å¯†ï¼Œç¡®ä¿æ•°æ®å®‰å…¨éš”ç¦»

#### ğŸŒ è·¨å¹³å°å…¼å®¹æ€§
- **ğŸ’» æ¡Œé¢ç«¯æ”¯æŒ**ï¼šå®Œç¾æ”¯æŒ Windowsã€macOSã€Linux ç­‰ä¸»æµæ“ä½œç³»ç»Ÿ
- **ğŸ“± ç§»åŠ¨ç«¯ä¼˜åŒ–**ï¼šé’ˆå¯¹ iOSã€Android ç§»åŠ¨æµè§ˆå™¨è¿›è¡Œä¸“é¡¹ä¼˜åŒ–
- **ğŸŒ æµè§ˆå™¨å…¼å®¹**ï¼šæ”¯æŒ Chromeã€Firefoxã€Safariã€Edge ç­‰ä¸»æµæµè§ˆå™¨

#### ğŸ¨ ç°ä»£åŒ–ç”¨æˆ·ç•Œé¢
- **ğŸ“± å“åº”å¼è®¾è®¡**ï¼šå®Œç¾é€‚é…å„ç§å±å¹•å°ºå¯¸ï¼Œä»æ‰‹æœºåˆ°å¤§å±æ˜¾ç¤ºå™¨
- **ğŸŒ™ æ·±è‰²æ¨¡å¼**ï¼šæ”¯æŒæ˜æš—ä¸»é¢˜åˆ‡æ¢ï¼Œä¿æŠ¤ç”¨æˆ·è§†åŠ›

---

## ğŸ“‹ ç›®å½•

- [ğŸ“š ä½¿ç”¨è¯´æ˜](#-ä½¿ç”¨è¯´æ˜)
- [ğŸ¯ é¡¹ç›®æ¦‚è¿°](#-é¡¹ç›®æ¦‚è¿°)
- [ğŸ—ï¸ æ¶æ„è®¾è®¡](#ï¸-æ¶æ„è®¾è®¡)
- [ğŸ”§ æ ¸å¿ƒæŠ€æœ¯è§£æ](#-æ ¸å¿ƒæŠ€æœ¯è§£æ)
  - [WebRTC è¿æ¥æœºåˆ¶è¯¦è§£](#webrtc-è¿æ¥æœºåˆ¶è¯¦è§£)
  - [æ–­ç‚¹ç»­ä¼ æœºåˆ¶æ·±åº¦è§£æ](#æ–­ç‚¹ç»­ä¼ æœºåˆ¶æ·±åº¦è§£æ)
- [ğŸ› ï¸ æŠ€æœ¯æ ˆå’Œä¾èµ–](#ï¸-æŠ€æœ¯æ ˆå’Œä¾èµ–)
- [â“ å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)

---

## ğŸ“š ä½¿ç”¨è¯´æ˜

### ç¯å¢ƒè¦æ±‚

- **Node.js**: >= 22.0.0
- **pnpm**: >= 9.7.1
- **ç°ä»£æµè§ˆå™¨**: æ”¯æŒ WebRTC çš„æµè§ˆå™¨ï¼ˆChrome 60+, Firefox 55+, Safari 14+ï¼‰

### å®‰è£…å’Œå¯åŠ¨

#### å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/beixiyo/web-share
cd web-share
```

#### Docker éƒ¨ç½²

```bash
# æ„å»º Docker é•œåƒ
docker build \
  --build-arg VITE_SERVER_URL_ARG=ws://YourHost:YourPort \
  -t web-share .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name=web-share \
  -p 7001:3001 \
  -e PORT=3001 \
  --restart=always \
  web-share
```

#### æœ¬åœ°å¼€å‘

```bash
# å…¨å±€å®‰è£… pnpm
npm i -g pnpm@9.7.1

# å®‰è£…é¡¹ç›®ä¾èµ–
pnpm i

# å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆé¦–æ¬¡è¿è¡Œéœ€è¦æ‰§è¡Œä¸¤æ¬¡ï¼Œæ„å»º common åŒ…ï¼‰
pnpm run dev

# åˆ†åˆ«å¯åŠ¨å„ä¸ªæœåŠ¡
pnpm run dev:server  # å¯åŠ¨ä¿¡ä»¤æœåŠ¡å™¨
pnpm run dev:client  # å¯åŠ¨å‰ç«¯å®¢æˆ·ç«¯
pnpm run dev:common  # æ„å»ºå…¬å…±ç±»å‹åŒ…
```

#### ç”Ÿäº§æ„å»º

```bash
# æ„å»ºæ‰€æœ‰åŒ…
pnpm run build

# åˆ†åˆ«æ„å»º
pnpm run build:common  # å…ˆæ„å»ºå…¬å…±åŒ…
pnpm run build:server  # æ„å»ºæœåŠ¡å™¨
pnpm run build:client  # æ„å»ºå®¢æˆ·ç«¯
```

### åŸºæœ¬ä½¿ç”¨æµç¨‹

#### ğŸ  åˆ›å»ºè¿æ¥

**æ–¹å¼ä¸€ï¼šæˆ¿é—´ç è¿æ¥**
1. ç‚¹å‡»"ç”Ÿæˆæˆ¿é—´ç "æŒ‰é’®
2. ç³»ç»Ÿç”Ÿæˆ 6 ä½æ•°å­—æˆ¿é—´ç 
3. å°†æˆ¿é—´ç åˆ†äº«ç»™å…¶ä»–ç”¨æˆ·
4. å…¶ä»–ç”¨æˆ·è¾“å…¥æˆ¿é—´ç åŠ å…¥æˆ¿é—´

**æ–¹å¼äºŒï¼šç›´è¿æˆ¿é—´**
1. ç‚¹å‡»"åˆ›å»ºç›´è¿æˆ¿é—´"
2. ç³»ç»Ÿç”Ÿæˆå”¯ä¸€æˆ¿é—´é“¾æ¥
3. é€šè¿‡äºŒç»´ç æˆ–é“¾æ¥åˆ†äº«ç»™å…¶ä»–è®¾å¤‡
4. æ‰«ç æˆ–ç‚¹å‡»é“¾æ¥ç›´æ¥åŠ å…¥

![è¿æ¥æ–¹å¼ç¤ºä¾‹](è¿æ¥æ–¹å¼ç¤ºä¾‹å ä½ç¬¦ - å¾…æˆªå›¾)

#### ğŸ“ æ–‡ä»¶ä¼ è¾“

**å‘é€æ–‡ä»¶**ï¼š
1. é€‰æ‹©è¦å‘é€çš„æ–‡ä»¶ï¼ˆæ”¯æŒå¤šæ–‡ä»¶é€‰æ‹©ï¼‰ï¼Œæˆ–è€…ç›´æ¥ `Ctrl + V` ç²˜è´´
2. ç³»ç»Ÿæ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆå’Œå¤§å°ä¿¡æ¯
3. ç‚¹å‡»"å‘é€æ–‡ä»¶"æŒ‰é’®
4. ç­‰å¾…æ¥æ”¶æ–¹ç¡®è®¤

**æ¥æ”¶æ–‡ä»¶**ï¼š
1. æ¥æ”¶åˆ°æ–‡ä»¶ä¼ è¾“è¯·æ±‚
2. æŸ¥çœ‹æ–‡ä»¶ä¿¡æ¯å’Œé¢„è§ˆå›¾
3. ç‚¹å‡»"æ¥å—"æˆ–"æ‹’ç»"
4. æ¥å—åè‡ªåŠ¨å¼€å§‹ä¸‹è½½

<img src="./docAssets/save.webp" alt="æ–‡ä»¶ä¼ è¾“ç•Œé¢" width="300px" />

#### âš¡ æ–­ç‚¹ç»­ä¼ 

**è‡ªåŠ¨æ–­ç‚¹ç»­ä¼ **ï¼š
- ä¼ è¾“ä¸­æ–­åï¼Œç³»ç»Ÿè‡ªåŠ¨ä¿å­˜è¿›åº¦
- é‡æ–°è¿æ¥åï¼Œæç¤ºæ˜¯å¦ç»§ç»­ä¼ è¾“
- æ”¯æŒæ¸…ç†è¿‡æœŸçš„ä¼ è¾“ç¼“å­˜

**æ‰‹åŠ¨ç®¡ç†**ï¼š
- åœ¨å·¥å…·æ ä¸­ç‚¹å‡»"æ¸…ç†ç¼“å­˜"
- é€‰æ‹©æ¸…ç†ç­–ç•¥ï¼ˆå…¨éƒ¨/è¿‡æœŸ/å¤±è´¥ï¼‰
- æŸ¥çœ‹ç¼“å­˜å ç”¨ç©ºé—´

### é«˜çº§åŠŸèƒ½

#### ğŸ”§ ç¼“å­˜ç®¡ç†

ç³»ç»Ÿæä¾›äº†å®Œå–„çš„ç¼“å­˜ç®¡ç†åŠŸèƒ½ï¼š

```typescript
/** æ¸…ç†è¿‡æœŸç¼“å­˜ï¼ˆ7å¤©ï¼‰ */
await resumeManager.cleanupExpiredCache(7)

/** è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯ */
const stats = await resumeManager.getCacheStats()

/** æ‰‹åŠ¨æ¸…ç†æŒ‡å®šæ–‡ä»¶ç¼“å­˜ */
await resumeManager.deleteResumeCache(fileHash)
```

#### ğŸ“Š ä¼ è¾“ç›‘æ§

å®æ—¶ç›‘æ§ä¼ è¾“çŠ¶æ€å’Œæ€§èƒ½ï¼š

- **ä¼ è¾“é€Ÿåº¦**ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰ä¼ è¾“é€Ÿåº¦
- **å‰©ä½™æ—¶é—´**ï¼šé¢„ä¼°ä¼ è¾“å®Œæˆæ—¶é—´
- **é”™è¯¯é‡è¯•**ï¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„ä¼ è¾“
- **è¿æ¥çŠ¶æ€**ï¼šæ˜¾ç¤º WebRTC è¿æ¥è´¨é‡

#### ğŸ› ï¸ è°ƒè¯•å·¥å…·

å¼€å‘ç¯å¢ƒä¸‹æä¾›è°ƒè¯•åŠŸèƒ½ï¼š

- **æ§åˆ¶å°æ—¥å¿—**ï¼šè¯¦ç»†çš„ä¼ è¾“æ—¥å¿—
- **ç½‘ç»œçŠ¶æ€**ï¼šWebRTC è¿æ¥ç»Ÿè®¡
- **æ€§èƒ½ç›‘æ§**ï¼šå†…å­˜å’Œ CPU ä½¿ç”¨æƒ…å†µ

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆå’Œä¾èµ–

### å‰ç«¯æŠ€æœ¯æ ˆ

#### ğŸ¨ æ ¸å¿ƒæ¡†æ¶
- **Vue 3.5.13**: æ¸è¿›å¼ JavaScript æ¡†æ¶
- **TypeScript 5.7.2**: é™æ€ç±»å‹æ£€æŸ¥
- **Vite**: ç°ä»£åŒ–æ„å»ºå·¥å…·
- **Vue Router 4.4.5**: å•é¡µåº”ç”¨è·¯ç”±

#### ğŸ¯ UI å’Œæ ·å¼
- **UnoCSS**: åŸå­åŒ– CSS å¼•æ“
- **Tailwind CSS**: å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶
- **Lucide Vue Next**: ç°ä»£å›¾æ ‡åº“

#### ğŸ”§ å·¥å…·åº“
- **@jl-org/tool**: é€šç”¨å·¥å…·å‡½æ•°åº“
- **LocalForage**: å®¢æˆ·ç«¯å­˜å‚¨è§£å†³æ–¹æ¡ˆ
- **QRCode**: äºŒç»´ç ç”Ÿæˆåº“

### åç«¯æŠ€æœ¯æ ˆ

#### ğŸŒ æœåŠ¡å™¨æ¡†æ¶
- **Express 5.1.0**: Web åº”ç”¨æ¡†æ¶
- **WebSocket (ws 8.18.2)**: WebSocket æœåŠ¡å™¨
- **Connect History API Fallback**: SPA è·¯ç”±æ”¯æŒ

#### ğŸ”§ å·¥å…·åº“
- **UA Parser JS**: ç”¨æˆ·ä»£ç†è§£æ
- **Unique Names Generator**: éšæœºåç§°ç”Ÿæˆ

### å¼€å‘å·¥å…·

#### ğŸ“¦ åŒ…ç®¡ç†
- **pnpm**: é«˜æ•ˆçš„åŒ…ç®¡ç†å™¨
- **Monorepo**: å¤šåŒ…ç®¡ç†æ¶æ„

#### ğŸ” ä»£ç è´¨é‡
- **ESLint**: ä»£ç æ£€æŸ¥å·¥å…·
- **@antfu/eslint-config**: ESLint é…ç½®é¢„è®¾

---

## â“ å¸¸è§é—®é¢˜

### ğŸ”§ æŠ€æœ¯é—®é¢˜

**Q: WebRTC è¿æ¥å¤±è´¥æ€ä¹ˆåŠï¼Ÿ**

A: å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
1. å°è¯•å…³é—­æ‰€æœ‰æµè§ˆå™¨æ’ä»¶ï¼Œæˆ–è€…å¼€æ— ç—•
2. æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒ WebRTC
3. æ£€æŸ¥ç½‘ç»œç¯å¢ƒï¼Œç¡®ä¿ä¸åœ¨ä¸¥æ ¼çš„ NAT æˆ–é˜²ç«å¢™å

**Q: æ–­ç‚¹ç»­ä¼ ä¸å·¥ä½œï¼Ÿ**

A: æ’æŸ¥æ­¥éª¤ï¼š
1. æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨ç©ºé—´æ˜¯å¦å……è¶³
2. ç¡®è®¤ LocalForage åˆå§‹åŒ–æˆåŠŸ
3. éªŒè¯æ–‡ä»¶å“ˆå¸Œç”Ÿæˆæ˜¯å¦ä¸€è‡´
4. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰ç¼“å­˜ç›¸å…³é”™è¯¯

### ğŸš€ éƒ¨ç½²é—®é¢˜

**Q: Docker éƒ¨ç½²åæ— æ³•è¿æ¥ï¼Ÿ**

A: æ£€æŸ¥æ¸…å•ï¼š
1. ç¡®ä¿ WebSocket æœåŠ¡å™¨ URL é…ç½®æ­£ç¡®
2. æ£€æŸ¥ç«¯å£æ˜ å°„æ˜¯å¦æ­£ç¡®
3. éªŒè¯é˜²ç«å¢™è®¾ç½®
4. ç¡®è®¤ HTTPS/WSS è¯ä¹¦é…ç½®

### ğŸ“± å…¼å®¹æ€§é—®é¢˜

**Q: ç§»åŠ¨ç«¯æµè§ˆå™¨å…¼å®¹æ€§ï¼Ÿ**

A: æ”¯æŒæƒ…å†µï¼š
- âœ… Chrome Mobile 60+
- âœ… Safari Mobile 14+
- âœ… Firefox Mobile 55+
- âŒ å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼ˆéƒ¨åˆ†åŠŸèƒ½å—é™ï¼‰

**Q: æ–‡ä»¶å¤§å°é™åˆ¶ï¼Ÿ**

A: é™åˆ¶è¯´æ˜ï¼š
- ç†è®ºä¸Šæ— å¤§å°é™åˆ¶ï¼Œç°ä»£æµè§ˆå™¨å¯ä»¥æ”¯æŒæˆ‘å†™çš„æµå¼ä¼ è¾“
- æ”¯æŒå¤šæ–‡ä»¶æ‰¹é‡ä¼ è¾“

### ğŸ”’ å®‰å…¨é—®é¢˜

**Q: æ–‡ä»¶ä¼ è¾“æ˜¯å¦å®‰å…¨ï¼Ÿ**

A: å®‰å…¨ä¿éšœï¼š
1. WebRTC æä¾›ç«¯åˆ°ç«¯åŠ å¯†
2. æ–‡ä»¶ä¸ç»è¿‡æœåŠ¡å™¨å­˜å‚¨
3. è¿æ¥å»ºç«‹åå³å¯æ–­å¼€ä¿¡ä»¤æœåŠ¡å™¨
4. æ”¯æŒæˆ¿é—´ç è¿‡æœŸæœºåˆ¶

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### åŠŸèƒ½ä»‹ç»

**WebRTC æ–‡ä»¶ä¼ è¾“ç³»ç»Ÿ** æ˜¯ä¸€ä¸ªåŸºäºç°ä»£ Web æŠ€æœ¯æ„å»ºçš„ç‚¹å¯¹ç‚¹æ–‡ä»¶ä¼ è¾“è§£å†³æ–¹æ¡ˆã€‚è¯¥é¡¹ç›®å®ç°äº†ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- ğŸ”— **ç‚¹å¯¹ç‚¹ç›´è¿ä¼ è¾“**ï¼šåˆ©ç”¨ WebRTC æŠ€æœ¯å®ç°æµè§ˆå™¨é—´çš„ç›´æ¥è¿æ¥ï¼Œæ— éœ€æ–‡ä»¶ç»è¿‡æœåŠ¡å™¨
- ğŸ“± **è·¨å¹³å°æ”¯æŒ**ï¼šæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯æµè§ˆå™¨ï¼Œå®ç°è®¾å¤‡é—´æ— ç¼æ–‡ä»¶ä¼ è¾“
- âš¡ **æ–­ç‚¹ç»­ä¼ **ï¼šæ”¯æŒä¼ è¾“ä¸­æ–­åçš„æ–­ç‚¹ç»­ä¼ åŠŸèƒ½ï¼Œæé«˜å¤§æ–‡ä»¶ä¼ è¾“çš„å¯é æ€§
- ğŸ  **æˆ¿é—´æœºåˆ¶**ï¼šæ”¯æŒåˆ›å»ºæˆ¿é—´ç æˆ–ç›´è¿æˆ¿é—´ï¼Œæ–¹ä¾¿å¤šè®¾å¤‡é—´çš„æ–‡ä»¶å…±äº«
- ğŸ”’ **å®‰å…¨ä¼ è¾“**ï¼šåŸºäº WebRTC çš„ç«¯åˆ°ç«¯åŠ å¯†ï¼Œç¡®ä¿æ–‡ä»¶ä¼ è¾“å®‰å…¨
- ğŸ“Š **å®æ—¶è¿›åº¦**ï¼šæä¾›è¯¦ç»†çš„ä¼ è¾“è¿›åº¦æ˜¾ç¤ºå’ŒçŠ¶æ€ç®¡ç†

### æŠ€æœ¯äº®ç‚¹

1. **ğŸ¨ ç°ä»£åŒ–æ¶æ„**ï¼šé‡‡ç”¨ Monorepo æ¶æ„ï¼Œæ¸…æ™°åˆ†ç¦»å®¢æˆ·ç«¯ã€æœåŠ¡ç«¯å’Œå…¬å…±ä»£ç 
2. **âš¡ é«˜æ€§èƒ½ä¼ è¾“**ï¼šåˆ©ç”¨ WebRTC DataChannel å®ç°é«˜é€Ÿæ–‡ä»¶ä¼ è¾“
3. **ğŸ”„ æ™ºèƒ½æ–­ç‚¹ç»­ä¼ **ï¼šåŸºäºæ–‡ä»¶å“ˆå¸Œçš„æ–­ç‚¹ç»­ä¼ æœºåˆ¶ï¼Œæ”¯æŒä¼ è¾“ä¸­æ–­æ¢å¤
4. **ğŸ“± å“åº”å¼è®¾è®¡**ï¼šå®Œå…¨å“åº”å¼çš„ç”¨æˆ·ç•Œé¢ï¼Œé€‚é…å„ç§è®¾å¤‡å±å¹•
5. **ğŸ›¡ï¸ ç±»å‹å®‰å…¨**ï¼šå…¨é¢ä½¿ç”¨ TypeScriptï¼Œæä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰å’Œæ£€æŸ¥
6. **ğŸ”§ å¯æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•å’Œç»´æŠ¤

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client A      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Signal Server â”‚
â”‚                 â”‚                  â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Vue3 + TS   â”‚â”‚                  â”‚  â”‚ Express +   â”‚â”‚
â”‚  â”‚ WebRTC      â”‚â”‚                  â”‚  â”‚ WebSocket   â”‚â”‚
â”‚  â”‚ LocalForage â”‚â”‚                  â”‚  â”‚ Server      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                    â–²
         â”‚                                    â”‚
         â”‚          WebRTC P2P                â”‚
         â”‚         DataChannel                â”‚
         â–¼                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    WebSocket     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client B      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
â”‚                 â”‚                  â”‚                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                  â”‚                 â”‚
â”‚  â”‚ Vue3 + TS   â”‚â”‚                  â”‚                 â”‚
â”‚  â”‚ WebRTC      â”‚â”‚                  â”‚                 â”‚
â”‚  â”‚ LocalForage â”‚â”‚                  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚                  â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### é¡¹ç›®ç»“æ„

```
web-share/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ client/          # å‰ç«¯å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ ClientServer/     # WebRTC è¿æ¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°å’Œæ–‡ä»¶å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ components/      # é€šç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ server/          # ä¿¡ä»¤æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ WSServer.ts      # WebSocket æœåŠ¡å™¨
â”‚   â”‚   â”‚   â””â”€â”€ main.ts          # æœåŠ¡å™¨å…¥å£
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ common/          # å…¬å…±ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ action.ts        # åŠ¨ä½œç±»å‹å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ RTCData.ts       # WebRTC æ•°æ®ç±»å‹
â”‚       â”‚   â””â”€â”€ message.ts       # æ¶ˆæ¯ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ package.json
â””â”€â”€ package.json         # æ ¹é…ç½®æ–‡ä»¶
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

#### ğŸ“¦ packages/client - å‰ç«¯å®¢æˆ·ç«¯

**ä¸»è¦èŒè´£**ï¼š
- ç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œäº¤äº’
- WebRTC è¿æ¥ç®¡ç†
- æ–‡ä»¶ä¼ è¾“é€»è¾‘å¤„ç†
- æ–­ç‚¹ç»­ä¼ ç¼“å­˜ç®¡ç†

**æ ¸å¿ƒç»„ä»¶**ï¼š
- `RTCPeer`: WebRTC å¯¹ç­‰è¿æ¥ç®¡ç†
- `FileSendManager`: æ–‡ä»¶å‘é€ç®¡ç†å™¨
- `FileDownloadManager`: æ–‡ä»¶ä¸‹è½½ç®¡ç†å™¨
- `ResumeManager`: æ–­ç‚¹ç»­ä¼ ç®¡ç†å™¨

#### ğŸŒ packages/server - ä¿¡ä»¤æœåŠ¡å™¨

**ä¸»è¦èŒè´£**ï¼š
- WebRTC ä¿¡ä»¤ä¸­ç»§
- æˆ¿é—´ç®¡ç†å’Œç”¨æˆ·åŒ¹é…
- è¿æ¥çŠ¶æ€ç»´æŠ¤
- å¿ƒè·³æ£€æµ‹

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
- WebSocket è¿æ¥ç®¡ç†
- æˆ¿é—´ç ç”Ÿæˆå’ŒéªŒè¯
- ç”¨æˆ·é‡è¿å¤„ç†
- æ¶ˆæ¯è·¯ç”±è½¬å‘

#### ğŸ“‹ packages/common - å…¬å…±ç±»å‹

**ä¸»è¦èŒè´£**ï¼š
- ç»Ÿä¸€çš„ç±»å‹å®šä¹‰
- å¸¸é‡é…ç½®ç®¡ç†
- æ¶ˆæ¯åè®®å®šä¹‰

**æ ¸å¿ƒå†…å®¹**ï¼š
- Action æšä¸¾å®šä¹‰
- WebRTC æ•°æ®ç±»å‹
- æ–‡ä»¶ä¼ è¾“ç›¸å…³ç±»å‹
- æ–­ç‚¹ç»­ä¼ æ•°æ®ç»“æ„

---

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯è§£æ

### WebRTC è¿æ¥æœºåˆ¶è¯¦è§£

WebRTCï¼ˆWeb Real-Time Communicationï¼‰æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ç°äº†æµè§ˆå™¨é—´çš„ç‚¹å¯¹ç‚¹é€šä¿¡ã€‚ä»¥ä¸‹è¯¦ç»†è§£æè¿æ¥å»ºç«‹çš„å®Œæ•´æµç¨‹ï¼š

#### ğŸ”„ è¿æ¥å»ºç«‹æµç¨‹

**1. åˆå§‹åŒ–é˜¶æ®µ**
```typescript
// RTCConnect.ts - initialize() æ–¹æ³•
private initialize(): void {
  this.pc = new RTCPeerConnection({
    iceServers: this.config.iceServers, // STUN/TURN æœåŠ¡å™¨é…ç½®
  })

  // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
  this.pc.ondatachannel = this.onDataChannel
  this.pc.onicecandidate = this.onIceCandidate
  this.pc.onconnectionstatechange = this.onConnectionStateChange
}
```

**2. ä¿¡ä»¤äº¤æ¢è¿‡ç¨‹**

```mermaid
sequenceDiagram
    participant A as Client A (å‘èµ·æ–¹)
    participant S as Signal Server
    participant B as Client B (æ¥æ”¶æ–¹)

    A->>S: 1. åˆ›å»º Offer
    S->>B: 2. è½¬å‘ Offer
    B->>S: 3. åˆ›å»º Answer
    S->>A: 4. è½¬å‘ Answer
    A->>S: 5. å‘é€ ICE Candidates
    S->>B: 6. è½¬å‘ ICE Candidates
    B->>S: 7. å‘é€ ICE Candidates
    S->>A: 8. è½¬å‘ ICE Candidates
    A->>B: 9. å»ºç«‹ P2P è¿æ¥
```

**3. è¯¦ç»†æ­¥éª¤è§£æ**

**æ­¥éª¤1: åˆ›å»º Offer**
- æ‰§è¡Œå‡½æ•°ï¼š`RTCConnect.createOffer()`
- ç­‰å¾…äº‹ä»¶ï¼šæ— 
- æˆåŠŸå¤„ç†ï¼šç”Ÿæˆ SDP Offerï¼Œé€šè¿‡ä¿¡ä»¤æœåŠ¡å™¨å‘é€ç»™ç›®æ ‡å®¢æˆ·ç«¯
- å¤±è´¥å¤„ç†ï¼šè§¦å‘ `onError` å›è°ƒï¼Œè®°å½•é”™è¯¯ä¿¡æ¯

**æ­¥éª¤2: å¤„ç† Answer**
- æ‰§è¡Œå‡½æ•°ï¼š`RTCConnect.handleAnswer()`
- ç­‰å¾…äº‹ä»¶ï¼šæ¥æ”¶è¿œç¨‹ SDP Answer
- æˆåŠŸå¤„ç†ï¼šè®¾ç½®è¿œç¨‹æè¿°ï¼Œå¼€å§‹ ICE å€™é€‰äº¤æ¢
- å¤±è´¥å¤„ç†ï¼šè¿æ¥å¤±è´¥ï¼Œè§¦å‘é‡è¿æœºåˆ¶

**æ­¥éª¤3: ICE å€™é€‰äº¤æ¢**
- æ‰§è¡Œå‡½æ•°ï¼š`RTCConnect.addIceCandidate()`
- ç­‰å¾…äº‹ä»¶ï¼šICE å€™é€‰æ”¶é›†å®Œæˆ
- æˆåŠŸå¤„ç†ï¼šå»ºç«‹æœ€ä¼˜è¿æ¥è·¯å¾„
- å¤±è´¥å¤„ç†ï¼šå°è¯•å…¶ä»–å€™é€‰æˆ–æŠ¥å‘Šè¿æ¥å¤±è´¥

**æ­¥éª¤4: æ•°æ®é€šé“å»ºç«‹**
- æ‰§è¡Œå‡½æ•°ï¼š`onDataChannel` äº‹ä»¶å¤„ç†
- ç­‰å¾…äº‹ä»¶ï¼šæ•°æ®é€šé“æ‰“å¼€
- æˆåŠŸå¤„ç†ï¼šè§¦å‘ `onChannelReady` å›è°ƒï¼Œå¼€å§‹æ–‡ä»¶ä¼ è¾“
- å¤±è´¥å¤„ç†ï¼šé‡æ–°å»ºç«‹è¿æ¥æˆ–æŠ¥å‘Šé”™è¯¯

#### ğŸ”§ ä¿¡ä»¤æœåŠ¡å™¨çš„ä½œç”¨

ä¿¡ä»¤æœåŠ¡å™¨åœ¨ WebRTC è¿æ¥ä¸­æ‰®æ¼”"åª’äºº"è§’è‰²ï¼š

1. **SDP äº¤æ¢ä¸­ç»§**ï¼šè½¬å‘ Offer å’Œ Answer æ¶ˆæ¯
2. **ICE å€™é€‰ä¸­ç»§**ï¼šè½¬å‘ç½‘ç»œè¿æ¥å€™é€‰ä¿¡æ¯
3. **æˆ¿é—´ç®¡ç†**ï¼šç»´æŠ¤ç”¨æˆ·æˆ¿é—´çŠ¶æ€å’Œè¿æ¥æ˜ å°„
4. **è¿æ¥çŠ¶æ€ç›‘æ§**ï¼šæ£€æµ‹ç”¨æˆ·åœ¨çº¿çŠ¶æ€å’Œè¿æ¥å¥åº·åº¦

#### ğŸ“¡ æ•°æ®é€šé“ç®¡ç†

æ•°æ®é€šé“æ˜¯æ–‡ä»¶ä¼ è¾“çš„æ ¸å¿ƒé€šé“ï¼š

```typescript
/** æ•°æ®é€šé“é…ç½® */
const channelOptions = {
  ordered: true, // ä¿è¯æ•°æ®é¡ºåº
  maxRetransmits: 3, // æœ€å¤§é‡ä¼ æ¬¡æ•°
}

/** å‘é€æ§åˆ¶ */
if (this.channel.bufferedAmount > this.config.bufferedAmountLowThreshold) {
  await this.waitUntilChannelIdle() // ç­‰å¾…ç¼“å†²åŒºç©ºé—²
}
```

**æµæ§åˆ¶æœºåˆ¶**ï¼š
- ç›‘æ§ `bufferedAmount` é˜²æ­¢ç¼“å†²åŒºæº¢å‡º
- å®ç°èƒŒå‹æ§åˆ¶ï¼Œç¡®ä¿ä¼ è¾“ç¨³å®šæ€§
- æ”¯æŒæš‚åœ/æ¢å¤ä¼ è¾“åŠŸèƒ½

---

### æ–­ç‚¹ç»­ä¼ æœºåˆ¶æ·±åº¦è§£æ

æ–­ç‚¹ç»­ä¼ æ˜¯æœ¬é¡¹ç›®çš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„ç¼“å­˜å’Œåå•†æœºåˆ¶ï¼Œå®ç°äº†å¯é çš„å¤§æ–‡ä»¶ä¼ è¾“ã€‚

#### ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

æ–­ç‚¹ç»­ä¼ ç³»ç»Ÿç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶æ„æˆï¼š

1. **ResumeManager**: æ–­ç‚¹ç»­ä¼ ç¼“å­˜ç®¡ç†
2. **FileSendManager**: å‘é€ç«¯æ–­ç‚¹ç»­ä¼ é€»è¾‘
3. **FileDownloadManager**: æ¥æ”¶ç«¯æ–­ç‚¹ç»­ä¼ é€»è¾‘
4. **WebRTC åå•†æœºåˆ¶**: åç§»é‡åå•†å’ŒåŒæ­¥

#### ğŸ“Š æ•°æ®æµå’Œæ§åˆ¶æµè¯¦è§£

**å®Œæ•´çš„æ–­ç‚¹ç»­ä¼ æµç¨‹å›¾**ï¼š

```
å‘é€ç«¯                                    æ¥æ”¶ç«¯
  â”‚                                        â”‚
  â”œâ”€1. ç”Ÿæˆæ–‡ä»¶å“ˆå¸Œ                         â”‚
  â”‚   generateFileHash()                   â”‚
  â”‚                                        â”‚
  â”œâ”€2. å‘é€æ–‡ä»¶å…ƒæ•°æ®                       â”‚
  â”‚   sendFileMetas() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  â”œâ”€3. æ¥æ”¶æ–‡ä»¶å…ƒæ•°æ®
  â”‚                                        â”‚   handleFileMetasForResume()
  â”‚                                        â”‚
  â”‚                                        â”œâ”€4. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
  â”‚                                        â”‚   getResumeInfo()
  â”‚                                        â”‚
  â”‚   â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 5. è¿”å›æ–­ç‚¹ä¿¡æ¯ â”œâ”€
  â”‚                           ResumeInfo   â”‚
  â”‚                                        â”‚
  â”œâ”€6. å¤„ç†æ–­ç‚¹ä¿¡æ¯                         â”‚
  â”‚   handleResumeInfo()                   â”‚
  â”‚                                        â”‚
  â”œâ”€7. ä»åç§»é‡å¼€å§‹å‘é€                      â”‚
  â”‚   sendSingleFile(startOffset) â”€â”€â”€â”€â”€â”€â–º  â”œâ”€8. ä»åç§»é‡å¼€å§‹æ¥æ”¶
  â”‚                                        â”‚   receiveDataChunk()
  â”‚                                        â”‚
  â”œâ”€9. å‘é€æ–‡ä»¶åˆ†ç‰‡                         â”‚
  â”‚   FileChunker.next() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”œâ”€10. ç¼“å­˜æ•°æ®åˆ†ç‰‡
  â”‚                                        â”‚    appendChunk()
  â”‚                                        â”‚
  â””â”€11. ä¼ è¾“å®Œæˆ                            â””â”€12. æ–‡ä»¶é‡ç»„å®Œæˆ
      FileDone                                download()
```

#### ğŸ” æ ¸å¿ƒå‡½æ•°è¯¦ç»†åˆ†æ

- **æ‰§è¡Œæ—¶æœº**ï¼šæ–‡ä»¶ä¼ è¾“å¼€å§‹å‰
- **è¾“å…¥å‚æ•°**ï¼šæ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°
- **è¿”å›å€¼**ï¼šå”¯ä¸€çš„æ–‡ä»¶æ ‡è¯†ç¬¦
- **ä¸‹ä¸€æ­¥**ï¼šç”¨äºç¼“å­˜é”®åç”Ÿæˆå’Œæ–­ç‚¹ä¿¡æ¯æŸ¥è¯¢

**2. æ–­ç‚¹ä¿¡æ¯è¯·æ±‚ (FileSendManager.requestResumeInfo)**

```typescript
private async requestResumeInfo(files: File[]): Promise<void> {
  for (const file of files) {
    const fileHash = this.resumeManager.generateFileHash(file.name, file.size)

    const resumeRequest: ResumeRequest = {
      fileHash,
      fileName: file.name,
      fileSize: file.size,
      fromId: this.config.getPeerId(),
    }

    // é€šè¿‡ WebRTC å‘é€æ–­ç‚¹ç»­ä¼ è¯·æ±‚
    this.config.sendJSON({
      type: Action.ResumeRequest,
      data: resumeRequest,
    })
  }
}
```

- **æ‰§è¡Œæ—¶æœº**ï¼šå‘é€æ–‡ä»¶å…ƒæ•°æ®å
- **ç­‰å¾…äº‹ä»¶**ï¼šæ¥æ”¶ç«¯è¿”å› `ResumeInfo` å“åº”
- **æˆåŠŸå¤„ç†**ï¼šè·å–åˆ° `startOffset`ï¼Œä»æŒ‡å®šä½ç½®å¼€å§‹ä¼ è¾“
- **å¤±è´¥å¤„ç†**ï¼šé»˜è®¤ä» 0 å¼€å§‹ä¼ è¾“ï¼ˆå…¨æ–°ä¼ è¾“ï¼‰

**3. ç¼“å­˜ä¿¡æ¯æŸ¥è¯¢ (FileDownloadManager.handleResumeRequest)**

```typescript
async handleResumeRequest(resumeRequest: ResumeRequest): Promise<void> {
  const { fileHash, fileName } = resumeRequest

  // æ£€æŸ¥æ˜¯å¦æœ‰ç¼“å­˜
  const resumeInfo = await this.resumeManager.getResumeInfo(fileHash)

  // å‘é€æ–­ç‚¹ç»­ä¼ ä¿¡æ¯å“åº”
  const response: ResumeInfo = {
    fileHash,
    startOffset: resumeInfo.startOffset,
    hasCache: resumeInfo.hasCache,
    fromId: resumeRequest.fromId,
  }

  this.config.sendJSON({
    type: Action.ResumeInfo,
    data: response,
  })
}
```

- **æ‰§è¡Œæ—¶æœº**ï¼šæ¥æ”¶åˆ° `ResumeRequest` æ¶ˆæ¯æ—¶
- **ç­‰å¾…äº‹ä»¶**ï¼šæ— ï¼ˆç«‹å³å“åº”ï¼‰
- **æˆåŠŸå¤„ç†**ï¼šè¿”å›ç¼“å­˜çš„ä¸‹è½½è¿›åº¦ä¿¡æ¯
- **å¤±è´¥å¤„ç†**ï¼šè¿”å› `startOffset: 0, hasCache: false`

**4. åˆ†ç‰‡ä¼ è¾“ (FileSendManager.sendSingleFile)**

```typescript
private async sendSingleFile(file: File, fileIndex: number): Promise<void> {
  const fileHash = this.resumeManager.generateFileHash(file.name, file.size)
  const resumeInfo = this.resumeInfoMap.get(fileHash)
  const startOffset = resumeInfo?.startOffset || 0

  // åˆ›å»ºæ–‡ä»¶åˆ†ç‰‡å™¨ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
  const chunker = new FileChunker(file, {
    chunkSize: this.config.chunkSize,
    startOffset, // å…³é”®ï¼šä»æŒ‡å®šåç§»é‡å¼€å§‹
  })

  // å‘é€æ–‡ä»¶åˆ†ç‰‡
  while (!chunker.done) {
    const blob = chunker.next()
    const arrayBuffer = await blob.arrayBuffer()

    // é€šè¿‡ WebRTC DataChannel å‘é€
    this.config.send(arrayBuffer)

    // å‘é€è¿›åº¦æ›´æ–°
    this.config.sendJSON({
      type: Action.Progress,
      data: progressData
    })
  }
}
```

- **æ‰§è¡Œæ—¶æœº**ï¼šæ¥æ”¶åˆ°æ–‡ä»¶æ¥å—ç¡®è®¤å
- **ç­‰å¾…äº‹ä»¶**ï¼šWebRTC é€šé“ç©ºé—²ï¼ˆæµæ§åˆ¶ï¼‰
- **æˆåŠŸå¤„ç†**ï¼šé€å—å‘é€æ–‡ä»¶æ•°æ®ï¼Œæ›´æ–°ä¼ è¾“è¿›åº¦
- **å¤±è´¥å¤„ç†**ï¼šè®°å½•é”™è¯¯ï¼Œå¯èƒ½è§¦å‘é‡ä¼ 

**5. æ•°æ®æ¥æ”¶å’Œç¼“å­˜ (FileDownloadManager.receiveDataChunk)**

```typescript
receiveDataChunk(data: Uint8Array): void {
  // æ·»åŠ åˆ°ä¸‹è½½ç¼“å†²åŒº
  this.downloadBuffer.push(data)

  // å¦‚æœæœ‰å½“å‰æ–‡ä»¶å“ˆå¸Œï¼Œå°†æ•°æ®å—æ·»åŠ åˆ°æ–­ç‚¹ç»­ä¼ ç¼“å­˜
  if (this.currentFileHash) {
    const arrayBuffer = data.buffer instanceof ArrayBuffer
      ? data.buffer.slice(data.byteOffset, data.byteOffset + data.byteLength)
      : new ArrayBuffer(data.byteLength)

    // å¼‚æ­¥ç¼“å­˜æ•°æ®å—
    this.resumeManager.appendChunk(this.currentFileHash, arrayBuffer)
      .catch((error) => {
        console.warn('æ·»åŠ æ•°æ®å—åˆ°ç¼“å­˜å¤±è´¥:', error)
      })
  }
}
```

- **æ‰§è¡Œæ—¶æœº**ï¼šæ¥æ”¶åˆ° WebRTC æ•°æ®å—æ—¶
- **ç­‰å¾…äº‹ä»¶**ï¼šæ— ï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
- **æˆåŠŸå¤„ç†**ï¼šæ•°æ®åŒæ—¶å†™å…¥ä¸‹è½½ç¼“å†²åŒºå’Œæ–­ç‚¹ç»­ä¼ ç¼“å­˜
- **å¤±è´¥å¤„ç†**ï¼šç¼“å­˜å¤±è´¥ä¸å½±å“æ­£å¸¸ä¸‹è½½ï¼Œåªè®°å½•è­¦å‘Š

#### ğŸ”„ WebRTC åå•†åç§»é‡è¿‡ç¨‹

æ–­ç‚¹ç»­ä¼ çš„å…³é”®åœ¨äºå‘é€ç«¯å’Œæ¥æ”¶ç«¯å°±ä¼ è¾“èµ·å§‹ä½ç½®è¾¾æˆä¸€è‡´ï¼š

**åå•†æ—¶åºå›¾**ï¼š

```mermaid
sequenceDiagram
    participant S as å‘é€ç«¯
    participant R as æ¥æ”¶ç«¯

    Note over S,R: æ–‡ä»¶ä¼ è¾“å‡†å¤‡é˜¶æ®µ
    S->>R: 1. FileMetas (æ–‡ä»¶å…ƒæ•°æ®)
    R->>R: 2. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
    R->>S: 3. ResumeInfo (startOffset: 1024000)
    S->>S: 4. è®¾ç½® FileChunker startOffset

    Note over S,R: æ–­ç‚¹ç»­ä¼ ä¼ è¾“é˜¶æ®µ
    S->>R: 5. NewFile (æ–‡ä»¶å¼€å§‹ä¿¡å·)
    S->>R: 6. æ•°æ®å— (ä» 1MB å¼€å§‹)
    R->>R: 7. æ¢å¤å·²ç¼“å­˜æ•°æ®
    R->>R: 8. è¿½åŠ æ–°æ•°æ®å—
    S->>R: 9. FileDone (ä¼ è¾“å®Œæˆ)
    R->>R: 10. æ–‡ä»¶é‡ç»„å’Œä¸‹è½½
```

**å…³é”®åå•†ç‚¹**ï¼š

1. **åç§»é‡è®¡ç®—**ï¼šåŸºäºå·²ç¼“å­˜çš„æ•°æ®å—å¤§å°
2. **ç¼“å­˜éªŒè¯**ï¼šç¡®ä¿ç¼“å­˜æ•°æ®çš„å®Œæ•´æ€§
3. **çŠ¶æ€åŒæ­¥**ï¼šå‘é€ç«¯å’Œæ¥æ”¶ç«¯çŠ¶æ€ä¿æŒä¸€è‡´
4. **é”™è¯¯æ¢å¤**ï¼šåå•†å¤±è´¥æ—¶çš„é™çº§å¤„ç†

#### ğŸ’¾ çŠ¶æ€ç®¡ç†å’Œæ•°æ®æŒä¹…åŒ–

**ç¼“å­˜æ•°æ®ç»“æ„**ï¼š

```typescript
interface ResumeCacheItem {
  fileHash: string
  fileName: string
  fileSize: number
  chunks: ArrayBuffer[] // æ•°æ®å—æ•°ç»„
  downloadedBytes: number // å·²ä¸‹è½½å­—èŠ‚æ•°
  createdAt: number // åˆ›å»ºæ—¶é—´
  updatedAt: number // æ›´æ–°æ—¶é—´
}

interface ResumeMetadata {
  [fileHash: string]: {
    fileName: string
    fileSize: number
    downloadedBytes: number
    createdAt: number
    updatedAt: number
  }
}
```

**æŒä¹…åŒ–ç­–ç•¥**ï¼š

1. **LocalForage å­˜å‚¨**ï¼šä½¿ç”¨ IndexedDB ä½œä¸ºä¸»è¦å­˜å‚¨å¼•æ“
2. **åˆ†ç¦»å¼è®¾è®¡**ï¼šå…ƒæ•°æ®å’Œå®é™…æ•°æ®åˆ†å¼€å­˜å‚¨
3. **è¿‡æœŸæ¸…ç†**ï¼šè‡ªåŠ¨æ¸…ç†è¿‡æœŸçš„ç¼“å­˜æ•°æ®
4. **å®¹é”™å¤„ç†**ï¼šå­˜å‚¨å¤±è´¥ä¸å½±å“æ­£å¸¸ä¼ è¾“

**ç¼“å­˜ç®¡ç†æ“ä½œ**ï¼š

- `createResumeCache()`: åˆ›å»ºæ–°çš„æ–­ç‚¹ç»­ä¼ ç¼“å­˜
- `appendChunk()`: è¿½åŠ æ•°æ®å—åˆ°ç¼“å­˜
- `getResumeInfo()`: è·å–æ–­ç‚¹ç»­ä¼ ä¿¡æ¯
- `deleteResumeCache()`: åˆ é™¤æŒ‡å®šç¼“å­˜
- `cleanupExpiredCache()`: æ¸…ç†è¿‡æœŸç¼“å­˜

#### âš ï¸ é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ

**å¸¸è§é”™è¯¯åœºæ™¯**ï¼š

1. **ç¼“å­˜æŸå**ï¼šæ£€æµ‹åˆ°ç¼“å­˜ä¸ä¸€è‡´æ—¶ï¼Œé‡æ–°å¼€å§‹ä¼ è¾“
2. **ç½‘ç»œä¸­æ–­**ï¼šä¿å­˜å½“å‰è¿›åº¦ï¼Œæ”¯æŒé‡æ–°è¿æ¥åç»§ç»­
3. **å­˜å‚¨ç©ºé—´ä¸è¶³**ï¼šæ¸…ç†æ—§ç¼“å­˜æˆ–æç¤ºç”¨æˆ·
4. **æ–‡ä»¶å˜æ›´**ï¼šæ£€æµ‹æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼Œå†³å®šæ˜¯å¦ä½¿ç”¨ç¼“å­˜

**å®¹é”™æœºåˆ¶**ï¼š

```typescript
/** ç¼“å­˜æ¢å¤å¤±è´¥çš„é™çº§å¤„ç† */
try {
  const cachedChunks = await this.resumeManager.getCachedChunks(fileHash)
  /** æ¢å¤ç¼“å­˜æ•°æ®... */
}
catch (error) {
  console.error('æ¢å¤ç¼“å­˜æ•°æ®å¤±è´¥:', error)
  /** é™çº§ä¸ºå…¨æ–°ä¸‹è½½ï¼Œä¸é˜»æ­¢æ–‡ä»¶ä¼ è¾“ */
  await this.resumeManager.deleteResumeCache(fileHash)
}
```

è¿™ç§è®¾è®¡ç¡®ä¿äº†å³ä½¿æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å‡ºç°é—®é¢˜ï¼ŒåŸºæœ¬çš„æ–‡ä»¶ä¼ è¾“åŠŸèƒ½ä»ç„¶å¯ç”¨ï¼Œæé«˜äº†ç³»ç»Ÿçš„å¥å£®æ€§ã€‚

---

<div align="center">

**ğŸŒŸ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ Starï¼**

---

**ğŸ“§ è”ç³»æˆ‘**

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

[![Email](https://img.shields.io/badge/Email-Contact-blue?style=flat-square&logo=gmail)](mailto:2662442385@qq.com)

---

**ğŸ“„ è®¸å¯è¯**

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)

</div>
